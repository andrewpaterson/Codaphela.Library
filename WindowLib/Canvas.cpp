#include "StandardLib/ClassDefines.h"
#include "NativeWindowFactory.h"
#include "NativeCanvas.h"
#include "Canvas.h"


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CCanvas::Init(CNativeWindowFactory* pcFactory, Ptr<CCanvasDraw> pDraw)
{
	PreInit();

	Init(CF_Unknown, -1, -1, pDraw, pcFactory);

	PostInit();
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CCanvas::Init(EColourFormat eFormat, int32 iWidth, int32 iHeight, Ptr<CCanvasDraw> pDraw, CNativeWindowFactory* pcFactory)
{
	meFormat = eFormat;
	miWidth = iWidth;
	miHeight = iHeight;

	mpcNativeCanvas = pcFactory->CreateNativeCanvas(this);
	CComplexComponent::Init(mpcNativeCanvas);

	mpCanvasDraw = pDraw;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CCanvas::Free(void)
{
	if (mpcNativeCanvas)
	{
		mpcNativeCanvas->mpcWindowFactory->DestroyNativeCanvas(mpcNativeCanvas);
		mpcNativeCanvas = NULL;
	}

	meFormat = CF_Unknown;
	miWidth = -1;
	miHeight = -1;

	CComplexComponent::Free();
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CCanvas::Class(void)
{
	CComplexComponent::Class();

	U_Pointer(mpcNativeCanvas);
	U_Enum(meFormat);
	U_Int32(miWidth);
	U_Int32(miHeight);
	M_Pointer(mpCanvasDraw);
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
bool CCanvas::Save(CObjectWriter* pcFile)
{
	return false;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
bool CCanvas::Load(CObjectReader* pcFile)
{
	return false;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
uint8* CCanvas::GetPixelData(void)
{
	return mpcNativeCanvas->GetPixelData();
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
bool CCanvas::Draw(void)
{
	mpCanvasDraw->Draw(this);
	return true;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CCanvas::CopyCanvas(Ptr<CCanvas> pcSourceCanvas)
{
	CNativeCanvas*	pcSourceNativeCanvas;
	CNativeCanvas*	pcDestNativeCanvas;

	pcDestNativeCanvas = GetNativeCanvas();
	pcSourceNativeCanvas = pcSourceCanvas->GetNativeCanvas();

	if (pcDestNativeCanvas)
	{
		pcDestNativeCanvas->CopyCanvas(pcSourceNativeCanvas);
	}
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CCanvas::DrawBox(CRectangle* pcRect, bool bFilled, ARGB32 sColour)
{
	mpcNativeCanvas->DrawBox(pcRect, bFilled, sColour);
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CCanvas::DrawPixel(int32 iX, int32 iY, ARGB32 sColour)
{
	mpcNativeCanvas->DrawPixel(iX, iY, sColour);
}

//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
bool CCanvas::IsValid(void)
{
	if ((meFormat == CF_Unknown) ||
		(miWidth == -1) ||
		(miHeight == -1))
	{
		return false;
	}
	return true;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
EColourFormat CCanvas::GetFormat(void) { return meFormat; }
int32 CCanvas::GetWidth(void) { return miWidth; }
int32 CCanvas::GetHeight(void) { return miHeight; }
CNativeCanvas* CCanvas::GetNativeCanvas(void) { return mpcNativeCanvas; }
Ptr<CCanvasDraw> CCanvas::GetCanvasDraw(void) { return mpCanvasDraw; }

