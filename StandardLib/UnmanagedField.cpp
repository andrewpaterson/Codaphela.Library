#include "BaseLib/TypeNames.h"
#include "Class.h"
#include "Classes.h"
#include "UnmanagedField.h"


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CUnmanagedField::Init(EPrimitiveType eType, ptrdiff_t iOffset, CClass* pcContainingClass, char* szName)
{
	Init(eType, iOffset, pcContainingClass, 1, szName);
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CUnmanagedField::Init(EPrimitiveType eType, ptrdiff_t iOffset, CClass* pcContainingClass, size_t uiLength, char* szName)
{
	CClasses*	pcClasses;
	CClass*		pcFieldClass;

	pcClasses = pcContainingClass->GetClasses();
	pcFieldClass = pcClasses->GetValid(eType);
	if (!pcFieldClass)
	{
		return;
	}

	CField::Init(pcFieldClass, iOffset, pcContainingClass, szName);
	muiElementSize = pcFieldClass->GetSizeOf();
	muiLength = uiLength;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CUnmanagedField::Init(EPrimitiveType eType, ptrdiff_t iOffset, CClass* pcContainingClass, uint32 uiElementSize, size_t uiLength, char* szName)
{
	CClasses*	pcClasses;
	CClass*		pcFieldClass;

	pcClasses = pcContainingClass->GetClasses();
	pcFieldClass = pcClasses->Get(eType);
	CField::Init(pcFieldClass, iOffset, pcContainingClass, szName);
	muiElementSize = uiElementSize;
	muiLength = uiLength;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CUnmanagedField::Kill(void)
{
	CField::Kill();
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
BOOL CUnmanagedField::IsArray(void)
{
	return muiLength > 1;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
size_t CUnmanagedField::GetLength(void)
{
	return muiLength;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
uint32 CUnmanagedField::GetSizeOf(void)
{
	return muiElementSize;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
BOOL CUnmanagedField::IsUnmanaged(void)
{
	return TRUE;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void* CUnmanagedField::GetData(CBaseObject* pcFieldContainer)
{
	return RemapSinglePointer(pcFieldContainer, muiOffset);
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
size_t CUnmanagedField::GetNameOffset(void)
{
	return sizeof(CUnmanagedField);
}

