#include "PrimitiveObject.h"
#include "BaseObject.h"
#include "Classes.h"
#include "Class.h"


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CClass::Init(char* szClassName, uint32 uiSize, EPrimitiveType eType, CClasses* pcClasses)
{
	mszClassName.Init(szClassName);
	mpcClassesThisIn = pcClasses;

	muiSize = uiSize;
	meType = eType;
	muiFlags = 0;

	macPointers.Init();
	macEmbeddedObjects.Init();
	macDatas.Init();
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CClass::Complete(void)
{
	muiFlags |= CLASS_FLAGS_COMPLETE;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CClass::Primitive(void)
{
	muiFlags |= CLASS_FLAGS_PRIMITIVE;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
BOOL CClass::IsComplete(void)
{
	return muiFlags & CLASS_FLAGS_COMPLETE;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
BOOL CClass::IsPrimitive(void)
{
	return muiFlags & CLASS_FLAGS_PRIMITIVE;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CClass::Kill(void)
{
	macPointers.Kill();
	macEmbeddedObjects.Kill();
	macDatas.Kill();

	muiFlags = 0;
	muiSize = 0;
	meType = PT_Undefined;

	mszClassName.Kill();
	mpcClassesThisIn = NULL;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CClass::Pointer(CBaseObject* pcThis, CPointer* pcPointer)
{
	CPointerField*	pcPointerField;
	ptrdiff_t		iOffset;

	iOffset = (size_t)pcPointer - (size_t)pcThis;
	pcPointerField = macPointers.Add();
	pcPointerField->Init(iOffset, this);
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CClass::Primitive(CBaseObject* pcThis, CPrimitiveObject* pcPrimitive)
{
	CDataField*		pcDataField;
	ptrdiff_t		iOffset;
	CClass*			pcClass;

	iOffset = (size_t)pcPrimitive - (size_t)pcThis;

	pcDataField = macDatas.Add();
	pcClass = GetClass(pcPrimitive->GetClassType());
	pcDataField->Init(pcClass, iOffset, this);
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CClass::Embedded(CBaseObject* pcThis, CBaseObject* pcObject)
{
	CEmbeddedObjectField*	pcEmbeddedObjectField;
	ptrdiff_t				iOffset;

	iOffset = (size_t)pcObject- (size_t)pcThis;

	pcEmbeddedObjectField = macEmbeddedObjects.Add();
	pcEmbeddedObjectField->Init(pcObject->GetClass(), iOffset, this);
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
CClasses* CClass::GetClasses(void)
{
	return mpcClassesThisIn;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
char* CClass::GetName(void)
{
	return mszClassName.Text();
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
EPrimitiveType CClass::GetType(void)
{
	return meType;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
CClass* CClass::GetClass(EPrimitiveType eType)
{
	return mpcClassesThisIn->Get(eType);
}

