#include "MapBlock.h"
#include "MapIndexAccess.h"


//////////////////////////////////////////////////////////////////////////
//																		//
//																		//
//////////////////////////////////////////////////////////////////////////
void CMapIndexAccess::Init(CMapBlock* pcMap)
{
	CIndexAccess::Init();
	mpcMap = pcMap;
}


//////////////////////////////////////////////////////////////////////////
//																		//
//																		//
//////////////////////////////////////////////////////////////////////////
BOOL CMapIndexAccess::Kill(void)
{
	mpcMap = NULL;
	return CIndexAccess::Kill();
}


//////////////////////////////////////////////////////////////////////////
//																		//
//																		//
//////////////////////////////////////////////////////////////////////////
BOOL CMapIndexAccess::Flush(void)
{
	return TRUE;
}


//////////////////////////////////////////////////////////////////////////
//																		//
//																		//
//////////////////////////////////////////////////////////////////////////
int64 CMapIndexAccess::NumElements(void)
{
	return mpcMap->NumElements();
}


//////////////////////////////////////////////////////////////////////////
//																		//
//																		//
//////////////////////////////////////////////////////////////////////////
BOOL CMapIndexAccess::ValidateIndex(void)
{
	return TRUE;
}


//////////////////////////////////////////////////////////////////////////
//																		//
//																		//
//////////////////////////////////////////////////////////////////////////
void CMapIndexAccess::Dump(void)
{
	mpcMap->Dump();
}


//////////////////////////////////////////////////////////////////////////
//																		//
//																		//
//////////////////////////////////////////////////////////////////////////
BOOL CMapIndexAccess::Put(void* pvKey, int iKeySize, void* pvData, size_t iDataSize)
{
	return mpcMap->Put(pvKey, iKeySize, pvData, iDataSize);
}


//////////////////////////////////////////////////////////////////////////
//																		//
//																		//
//////////////////////////////////////////////////////////////////////////
BOOL CMapIndexAccess::Get(void* pvKey, int iKeySize, void* pvDestData, size_t* piDataSize, size_t uiMaxDataSize)
{
	void*			pvData;
	BOOL			bResult;
	unsigned int	uiDataSize;

	bResult = mpcMap->Get(pvKey, iKeySize, &pvData, (int*)&uiDataSize);
	if (bResult)
	{
		SafeAssign(piDataSize, uiDataSize);
		memcpy(pvDestData, pvData, MinDataSize(uiDataSize, uiMaxDataSize));
	}
	return bResult;
}


//////////////////////////////////////////////////////////////////////////
//																		//
//																		//
//////////////////////////////////////////////////////////////////////////
int CMapIndexAccess::DataSize(void* pvKey, int iKeySize)
{
	return mpcMap->DataSize(pvKey, iKeySize);
}


//////////////////////////////////////////////////////////////////////////
//																		//
//																		//
//////////////////////////////////////////////////////////////////////////
BOOL CMapIndexAccess::Remove(void* pvKey, int iKeySize)
{
	return mpcMap->Remove(pvKey, iKeySize);
}


//////////////////////////////////////////////////////////////////////////
//																		//
//																		//
//////////////////////////////////////////////////////////////////////////
BOOL CMapIndexAccess::Has(void* pvKey, int iKeySize)
{
	return mpcMap->HasKey(pvKey, iKeySize);
}


//////////////////////////////////////////////////////////////////////////
//																		//
//																		//
//////////////////////////////////////////////////////////////////////////
BOOL CMapIndexAccess::Flush(void* pvKey, int iKeySize)
{
	if (Has(pvKey, iKeySize))
	{
		return TRUE;
	}
	return FALSE;
}


//////////////////////////////////////////////////////////////////////////
//																		//
//																		//
//////////////////////////////////////////////////////////////////////////
BOOL CMapIndexAccess::Evict(void* pvKey, int iKeySize)
{
	return FALSE;
}


//////////////////////////////////////////////////////////////////////////
//																		//
//																		//
//////////////////////////////////////////////////////////////////////////
CIndexTreeIterator* CMapIndexAccess::CreateIterator(void)
{
	return NULL;
}


//////////////////////////////////////////////////////////////////////////
//																		//
//																		//
//////////////////////////////////////////////////////////////////////////
void CMapIndexAccess::FreeIterator(CIndexTreeIterator* pcIter)
{
}

