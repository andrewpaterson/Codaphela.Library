#ifndef __STACK_MEMORY_H__
#define __STACK_MEMORY_H__
#include "PointerFunctions.h"
#include "PrimitiveTypes.h"
#include "Numbers.h"


template<size I = 4 KB>
class CStackMemory
{
private:
	char	macOnStack[I];
	void*	mpvOffStack;

public:
	void*	Init(void);
	void*	Init(size iSize);
	void	Kill(void);
	size	GetStackSize(void);
	void*	GetStackData(void);
};


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
template<size I>
void* CStackMemory<I>::Init(void)
{
	mpvOffStack = NULL;
	return macOnStack;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
template<size I>
void* CStackMemory<I>::Init(size iSize)
{
	if (iSize > I)
	{
		mpvOffStack = malloc(iSize);
		return mpvOffStack;
	}
	else
	{
		mpvOffStack = NULL;
		return macOnStack;
	}
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
template<size I>
void CStackMemory<I>::Kill(void)
{
	SafeFree(mpvOffStack);
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
template<size I>
size CStackMemory<I>::GetStackSize(void)
{
	return I;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
template<size I>
void* CStackMemory<I>::GetStackData(void)
{
	if (mpvOffStack)
	{
		return mpvOffStack;
	}
	else
	{
		return macOnStack;
	}
}


#endif // __STACK_MEMORY_H__

