#include "SystemAllocator.h"
#include "MemoryBlock.h"


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CMemoryBlock::Init(void)
{
	Init(&gcSystemAllocator);
}

//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CMemoryBlock::Init(CMallocator* pcMalloc)
{
	mpcMalloc = pcMalloc;
	mpvMem = NULL;
	mtSize = 0;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CMemoryBlock::Kill(void)
{
	Free(mpvMem);
	mpvMem = NULL;
	mtSize = 0;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void* CMemoryBlock::GetMemory(void)
{
	return mpvMem;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void* CMemoryBlock::Allocate(size_t tSize)
{
	if (mpvMem == NULL)
	{
		mpvMem = Malloc(tSize);
	}
	else
	{
		mpvMem = Realloc(mpvMem, tSize);
	}

	if (mpvMem != NULL)
	{
		mtSize = tSize;
	}
	else
	{
		mtSize = 0;
	}

	return mpvMem;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
size_t CMemoryBlock::GetSize(void)
{
	return mtSize;
}


//////////////////////////////////////////////////////////////////////////
//																		//
//																		//
//////////////////////////////////////////////////////////////////////////
void* CMemoryBlock::Malloc(size_t tSize)
{
	return mpcMalloc->Malloc(tSize);
}


//////////////////////////////////////////////////////////////////////////
//																		//
//																		//
//////////////////////////////////////////////////////////////////////////
void CMemoryBlock::Free(void* pv)
{
	mpcMalloc->Free(pv);
}


//////////////////////////////////////////////////////////////////////////
//																		//
//																		//
//////////////////////////////////////////////////////////////////////////
void* CMemoryBlock::Realloc(void* pv, size_t tSize)
{
	pv = mpcMalloc->Realloc(pv, tSize);
	return pv;
}

