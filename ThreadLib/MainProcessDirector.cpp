#include "BaseLib/Chars.h"
#include "MainProcessDirector.h"


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CMainProcessDirector::Init(void)
{
	mmszRedirects.Init(FALSE, TRUE);
	mbRanRedirect = FALSE;
	miRedirectResult = 0;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CMainProcessDirector::Kill(void)
{
	mmszRedirects.Kill();
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CMainProcessDirector::AddRedirect(char* szName, main_func fMain)
{
	mmszRedirects.Put(szName, &fMain, sizeof(main_func));
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
BOOL CMainProcessDirector::Run(int argc, char* argv[])
{
	main_func*	pfMain;
	CChars		sz;

	if (argc >= 2)
	{
		sz.Init(argv[1]);
		sz.LowerCase();
		if (sz.StartsWith("--"))
		{
			sz.RemoveFromStart(2);
		}
		else if (sz.StartsWith("-"))
		{
			sz.RemoveFromStart(1);
		}
		
		pfMain = (main_func*)(mmszRedirects.Get(sz.Text()));
		sz.Kill();
		if (pfMain)
		{
			mbRanRedirect = TRUE;
			miRedirectResult =(*pfMain)(argc-2, &argv[2]);
			return TRUE;
		}
	}
	return FALSE;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
int CMainProcessDirector::GetResult(void)
{
	return miRedirectResult;
}

