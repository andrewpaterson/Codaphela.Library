#include "BaseLib/Logger.h"
#include "WindowsError.h"
#include "SharedMemoryDescriptor.h"
#include "WindowsSharedMemory.h"


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CSharedMemory::Init(char* szName)
{
	mcMappedFile.Init(szName);
	mpsDescriptor = NULL;
	mpvMemory = NULL;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
BOOL CSharedMemory::Kill(void)
{
	mcMappedFile.Kill();
	mpsDescriptor = NULL;
	mpvMemory = NULL;
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
char* CSharedMemory::GetName(void)
{
	return mcMappedFile.GetName();
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void* CSharedMemory::Create(size_t uiSize)
{
	SSharedMemoryResult sResult = mcMappedFile.Create(uiSize);

	if (sResult.IsSuccess())
	{
		mpsDescriptor = mcMappedFile.Map(sResult.uiSize);
		mpvMemory = RemapSinglePointer(mpsDescriptor, sizeof(SSharedMemoryDescriptor));
	}
	else
	{
		return gcLogger.Error2(__METHOD__, " Could not map file [", mcMappedFile.GetName, "].  Failed with [", WindowsErrorCodeToString(GetLastError()), "].", NULL);
	}
}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void* CSharedMemory::Open(void)
{

}


//////////////////////////////////////////////////////////////////////////
//
//
//////////////////////////////////////////////////////////////////////////
void CSharedMemory::Close(void)
{

}
